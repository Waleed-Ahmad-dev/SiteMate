name: Deploy SiteMate

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploying via SSH
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SERVER_IP }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            echo "ðŸš€ Starting Deployment for SiteMate..."

            # 1. Define the specific path for the NEW module
            # We are assuming you will clone the renamed repo 'SiteMate' into this folder
            PROJECT_PATH="/root/ELB/addons/SiteMate"

            # 2. Check if the folder exists (First time setup vs Update)
            if [ ! -d "$PROJECT_PATH" ]; then
              echo "ðŸ“‚ Folder not found. Cloning for the first time..."
              mkdir -p /root/ELB/addons
              cd /root/ELB/addons
              # Clone the repo and name the folder 'SiteMate'
              git clone https://github.com/Waleed-Ahmad-dev/SiteMate.git
            fi

            # 3. Go to the folder
            cd $PROJECT_PATH

            # 4. Git Safety & Pull
            git config --global --add safe.directory $PROJECT_PATH
            git stash
            git pull origin main

            # 5. Restart Odoo (Update this container name after you set up the new server!)
            docker restart elb-odoo18-uxsjjb-web-1

            echo "âœ… Deployment Finished!"
